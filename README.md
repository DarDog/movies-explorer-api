# Проект Movies-explorer-API

Это мой API для работы с пользователями в рамках дипломной работы от Яндекс.Практикум.

## Документация

API работает с куки и для основных запросов нужно пройти аутентификацию.

Базовый URL: http://movie.explorer.subb.nomoredomains.rocks
Публичный IP: 62.84.114.44

Все ссылки в запросах являются эндпоинтами и должны подставляться к базовому URL.

Все запросы не соответствующие следующим инструкциям возвращают 404 код ошибки.

* Запрос для регистрации нового пользователя:

        POST /signup
        
        //Тело запроса должно содержать обязательные поля email name password в формате JSON
        //Пример
        
        {
          "email": "example@example.com", //Поле обязательно должно быть в формате email, является уникальным для всех пользователей
          "name": "example",
          "password": "example"
        }
        
        //Запрос возвращает объект с данными созданого пользователя
        
* Запрос для аутентификации пользователя:

        POST /signin
        
        //Тело запроса должно содержать обязательные поля email и password в формате JSON
        //Пример
        
        {
          "email": "example@example.com",
          "password": "example"
        }
        
        //После успешной аутентификации сервер возращает httponly cookie в заголовке set-cookie

___
### Следующие запросы требуют успешную аутентификацию
___

* Запрос для получения данных текущего пользователя:

        GET /users/me
        
        //Запрос возвращает объект с полями _id, name, email
        
* Запрос для обновления данных текущего пользователя:

        PATCH /users/me
        
        //Тело запроса должно содержать обязательные поля email, name
        //Пример
        
        {
          "email": "example@example.com",
          "name": "example"
        }
        
        //Запрос возвращает объект с обновлеными данными пользователя

* Запрос для получения массива сохраненных пользователем фильмов:

        GET /movies
        
        //Объект возвращает массив объектов содержащих поля сохраненых фильмов
        
* Запрос для добавления сохраненного фильма: 

        POST /movies
        
        //Тело запроса должно содержать все поля из примера ниже, все поля являются обязательными
        //Пример
        
        {
            "country": "Example",
            "director": "example",
            "duration": 10241024, //Тип Number, ms
            "year": "2042", //Тип String
            "description": "Example description",
            "image": "https://some.url", //Обязательно в формате URL
            "trailer": "https://some.url", //Обязательно в формате URL
            "thumbnail": "https://some.url", //Обязательно в формате URL
            "movieId": "123123asd",
            "nameRU": "Пример названия фильма",
            "nameEN": "Example movie name"
        }
        
        //Запрос возвращает объект добавленого фильма

* Запрос для удаления фильма (поиск осуществляется по полю _id) 

        DELETE /movies/:movieId
        
        //movieId является полем _id объекта фильма
        //Запрос возвращает сообщение об успешном удаление

* Запрос для завершения сеанса (Выход):

        Get /signout
        
        //Запрос удаляет cookie на клиенте и отправляет сообщение об успешном выходу

### Установка проекта на локальной машине

Для запуска на локальной машине вам требуется:

* Клонировать репозиторий

        git@github.com:DarDog/movies-explorer-api.git

* Перейти в директорию с проектом и установить npm зависимости

        cd ../movies-explorer-api
        npm install

* Запустить бд и сервера на локальной машине (По умолчанию используется порт 3000)

        mongod
        npm run dev //Запуск в dev моде с хот релоудом
        npm run start //Запуск в prod моде без хот релоуда
___
### PS 

* Если у вас не сохраняются куки например в Postman:

        //Причиной является, то что куки в настоящий момент настроены на работу с браузерами и успешным выполнением CORS
        //В этом случае вы можете перейти на сайт и проверить работу API совместно с фронтэндом
        //Также вы можете установить API на ваш десктоп и изменить настройки куки локально
        //Инструкция ко второму пункту:
        
        cd ../movies-explorer-api/controllers
        
        // Открыть контроллер users и перейти к функции login
        // Измените фрагмент 
        ...
        res
          .cookie('jwt', token, {
            maxAge: 3600000 * 24 * 7,
            httpOnly: true,
            sameSite: 'None',
            secure: true,
          })
          .end();
        ...
        // На 
        ...
        res
          .cookie('jwt', token, {
            maxAge: 3600000 * 24 * 7,
            httpOnly: true,
          })
        .end();
        ...
* [Сайт с фронтэндом проекта](https://movie.explorer.subb.front.nomoredomains.rocks)
* Если у вас в браузере не сохраняются куки:

        //Причиной является, то что куки настроены на работу с Postman
        //Вы можете использовать инструкцию выше и заменит указанный фрагмент на первый вариант, тогда куки будут успешно работать с браузерами и CORS
* [Репозиторий с фронтэндом проекта](https://github.com/DarDog/movies-explorer-frontend)
